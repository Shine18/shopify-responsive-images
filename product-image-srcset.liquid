{% comment %}
Shopify responsive product images with srcset.

Example:

  Include this snippet on a product page or within a products loop:

  {% include 'product-image-srcset',
    sizes: '(max-width: 640px) 50vw, (min-width: 641px) and (max-width: 960px) 33vw, 25vw' %}

  Output:

    <img src="//cdn.shopify.com/.../products/IMG_medium.jpg"
      srcset="
        //cdn.shopify.com/.../products/IMG_small.jpg     100w,
        //cdn.shopify.com/.../products/IMG_compact.jpg   160w,
        //cdn.shopify.com/.../products/IMG_medium.jpg    240w,
        //cdn.shopify.com/.../products/IMG_large.jpg     480w,
        //cdn.shopify.com/.../products/IMG_grande.jpg    600w,
        //cdn.shopify.com/.../products/IMG_1024x1024.jpg 1024w"
      sizes="(max-width: 640px) 50vw, (min-width: 641px) and (max-width: 960px) 33vw, 25vw"
      alt="Product title"
    />

Options:

  sizes         - Media queries describing how large the image will be at various screen sizes.
                  REQUIRED
                  Default: '50vw' (the image will always occupy 50% of the viewport width)

  image         - Product image to display
                  OPTIONAL
                  Default: product.featured_image

  default_size  - Shopify image size to load as default <img> src
                  OPTIONAL
                  Default: 'medium'

  is_portrait   - If the image is portrait rather than landscape, set this option
                  to true or srcset calculations will be incorrect.
                  OPTIONAL
                  Default: nil

  aspect_ratio  - If is_portrait = true, then you should specify the aspect ratio of
                  the image, in decimal form. i.e. 4:3 == 0.75 (width/height)
                  OPTIONAL
                  Default: 0.75

  attributes    - String of additional HTML attributes for the <img> tag
                  OPTIONAL
                  Default: ""

More information about srcset and sizes:
- https://ericportis.com/posts/2014/srcset-sizes/
- http://martinwolf.org/2014/05/07/the-new-srcset-and-sizes-explained/

{% endcomment %}

{% assign default_default_size = "medium" %}
{% assign default_sizes = "50vw" %}
{% assign default_image = product.featured_image %}
{% assign default_portrait_scale = 0.75 %}

{% if default_default_size != nil %}{% assign image_size = default_default_size %}{% endif %}
{% if default_sizes != nil %}{% assign sizes = default_sizes %}{% endif %}
{% if default_image != nil %}{% assign product_image = default_image %}{% endif %}

{% if is_portrait == true %}
  {% if aspect_ratio != nil %}
    {% assign scale = aspect_ratio %}
  {% else %}
    {% assign scale = default_portrait_scale %}
  {% endif %}
{% else %}
  {% assign scale = 1 %}
{% endif %}

<img src="{{ image.src | product_img_url: image_size }}"
  srcset="
    {{ image.src | product_img_url: 'small' }}     {{ 100  | times: scale | round }}w,
    {{ image.src | product_img_url: 'compact' }}   {{ 160  | times: scale | round }}w,
    {{ image.src | product_img_url: 'medium' }}    {{ 240  | times: scale | round }}w,
    {{ image.src | product_img_url: 'large' }}     {{ 480  | times: scale | round }}w,
    {{ image.src | product_img_url: 'grande' }}    {{ 600  | times: scale | round }}w,
    {{ image.src | product_img_url: '1024x1024' }} {{ 1024 | times: scale | round }}w"
  sizes="{{ sizes }}"
  alt="{{ image.alt | escape }}"
  {% if attributes != nil %}{{ attributes }}{% endif %}
/>
